-
  function _isDisputeOwner() {
    return (currentUser && (currentUser.id === dispute.user.id));
  }

  function _isFollowUpConfirmed() {
    return dispute.data.disputeConfirmFollowUp;
  }

  var avatarUrl = CONFIG.discourse.baseUrl + currentUser.avatarTemplate.replace('{size}', '240')

.Dispute__step-content(
  data-dispute-follow-up
  aria-hidden= (currentSection !== 'follow-up').toString()
)
  div
    .clearfix.mxn2.pb3
      .col.md-col-4.col-12.px2
        .Dispute__FollowUp__card.rounded.py3.px2.-bg-white.-dark
          h3.pb4= dispute.disputeTool.name
          .flex.items-center.pb1
            div: svg.block.-primary(width='46' height='56'): use(xlink:href='#svg-fingerprint')
            .pl2.-ff-sec
              - var _formData = dispute.data.forms && dispute.data.forms['personal-information-form'] || {}
              .-fw-600= _formData && _formData.name || ''

      .col.md-col-8.col-12.px2

        - var _headingText = '';
        case dispute.disputeTool.id
          // General Debt Dispute Letter
          when '11111111-1111-3333-1111-111111111111'
            - _headingText = 'Thank you for disputing your debt.'
          // Private Student Loan Dispute Letter
          when '11111111-1111-6666-1111-111111111111'
            - _headingText = 'Thank you for disputing your private student debt.'
          default
            - _headingText = `Thank you for disputing ${dispute.disputeTool.name}`;

        h4.Dispute__FollowUp__Title.pb3.pt2= _headingText
        h3.pb3 Now what?
        .-fw-500!= dispute.disputeTool.data.nowWhat

        if lastStatus.status !== 'Documents Sent'
          .mt2
            if lastStatus.status !== 'Completed'
              form(method='post' action=routeMappings.Disputes.updateSubmission.url(dispute.id) onsubmit="this.submitButton.disabled = true")
                input(type='hidden' name='_method' value='put')
                ul.list-reset
                  li.form-check.form-check-inline
                    input(type='radio' name='pending_submission' id='pending-submission-dc-to-mail' value='1' required)
                    label.form-check-label(for='pending-submission-dc-to-mail') I want the Debt Collective to mail a hard copy of my dispute
                  li.form-check.form-check-inline
                    input(type='radio' name='pending_submission' id='pending-submission-member-to-mail' value='0' required)
                    label.form-check-label(for='pending-submission-member-to-mail') I prefer to print and mail it myself
                button(type='submit' name='submitButton').-fw-600.-k-btn.btn-primary.mt2 Save changes
            else
              if lastStatus.pendingSubmission
                p Your dispute is being processed, thank you.
              else
                p A copy of your dispute has been sent to your email.


    if dispute.data.disputeConfirmFollowUp
      .-caption.-neutral-mid.-ttu.-fw-600 Your dispute status:
      h4.Dispute__FollowUp__MainStatus.pb1.mb2.-ttu(
        class=`-status-${lastStatus.status.toLowerCase().replace(/\W/g, '-')}`
      )= lastStatus.status

      .mb3
        each status in dispute.statuses
          -
            var userUpdate = false;

            if (status.status === 'User Update') {
              userUpdate = true;
            }

          .StatusItem.py2.clearfix
            .StatusItem-Avatar.left
              if userUpdate
                //- if (dispute.user.account.image.exists('small'))
                //-   img.block.-fw(src=dispute.user.account.image.urls['small'] alt=dispute.user.account.name)
                //- else
                //- TODO Use Discourse provided profile image
                img.block(width='50' height='50' src=avatarUrl)
              else
                .StatusItem-TDC-placeholder

            .StatusItem-Text
              .clearfix
                .left
                  if userUpdate
                    p.-fw-600= dispute.user.name
                  else
                    p.-fw-600.-primary= 'The Debt Collective'
                  .-caption.-neutral-mid
                    <svg class="inline-block" width="13" height="11">
                      <use xlink:href="#svg-reply"></use>
                    </svg>
                    .ml1.inline-block.-fw-600= new Date(status.createdAt).toString()
                .right
                  p.-caption.-fw-600.-ttu(
                    class=`-status-${status.status.toLowerCase().replace(/\W/g, '-')}`
                  )= status.status
              p.-fw-500= status.comment

        if _isDisputeOwner()
          .py2.clearfix
            .StatusItem-Avatar.left
              //- if (currentUser.account.image.exists('small'))
              //-   img.block.-fw(src=currentUser.account.image.urls['small'] alt=currentUser.account.name)
              //- else
              //- TODO Use Discourse provided profile picture
              img.block(width='50' height='50' src='/images/profile/placeholder-small.png')

            .StatusItem-Text
              form(
                action=routeMappings.Disputes.update.url(dispute.id)
                method='post'
                data-component-form='dispute-comment'
              )
                input(name='_method' type='hidden' value='PUT')

                h4 Got a reply?
                p Tell us when you receive a response or any further communication from the creditor or collector.

                textarea.form-control.block.my2.-fw(
                  name='comment'
                  rows='5'
                  placeholder='Briefly describe the response you gotâ€¦'
                )
                .flex
                  p.mt1.mr3.-caption.-fw-500 We follow very closely what happens with these disputes so that we can find out which creditors are not breaking the law.
                  button.Dispute__FollowUp__SendBtn.-k-btn.btn-primary.-fw-600(
                    type='submit'
                  ) Send

  if _isDisputeOwner() && !_isFollowUpConfirmed()
    .-k-popover.-bottom-right.-success.absolute(data-component-popover='dispute-completed' aria-hidden='true' style='width: 290px;')
      .-k-popover-wrapper
        .-k-popover__arrow
        .-k-popover-body.p2.pr4
          button.btn-clear.-k-popover__close(aria-label='close')
            svg(width='13' height='13')
              use(xlink:href='#svg-close')
          .-dark.-fw-600 Access your filled tools
          p.-fw-500 You can follow up your tools anytime through your My Disputes page
